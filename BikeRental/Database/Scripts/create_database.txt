-- Ensure tables exist first (create minimal if you need)
CREATE TABLE IF NOT EXISTS manufacturers (
  manufacturer_id INT PRIMARY KEY AUTO_INCREMENT,
  name VARCHAR(255) NOT NULL,
  description TEXT
) ENGINE=InnoDB;

CREATE TABLE IF NOT EXISTS users (
  user_id INT PRIMARY KEY AUTO_INCREMENT,
  firstname VARCHAR(100) NOT NULL,
  lastname  VARCHAR(100) NOT NULL,
  email     VARCHAR(255) NOT NULL UNIQUE
  password  VARCHAR(100) NOT NULL
) ENGINE=InnoDB;

CREATE TABLE IF NOT EXISTS bikes (
  bike_id INT PRIMARY KEY AUTO_INCREMENT,
  manufacturer_id INT NOT NULL,
  model VARCHAR(255) NOT NULL,
  year INT NOT NULL,
  price DECIMAL(10,2) NOT NULL,
  status VARCHAR(20) NOT NULL,
  current_renter_id INT NULL,
  rent_date DATETIME NULL,
  rent_time INT NULL
) ENGINE=InnoDB;

ALTER TABLE bikes
  ADD CONSTRAINT fk_bikes_manufacturer
    FOREIGN KEY (manufacturer_id) REFERENCES manufacturers(manufacturer_id)
    ON UPDATE RESTRICT ON DELETE RESTRICT;

ALTER TABLE bikes
  ADD CONSTRAINT fk_bikes_user
    FOREIGN KEY (current_renter_id) REFERENCES users(user_id)
    ON UPDATE RESTRICT ON DELETE SET NULL;
